__CONFIG    _CONFIG1, _LVP_OFF & _FCMEN_ON & _IESO_OFF & _BOR_OFF & _CPD_OFF & _CP_OFF & _MCLRE_ON & _PWRTE_ON & _WDT_OFF & _INTRC_OSC_NOCLKOUT
    __CONFIG    _CONFIG2, _WRT_OFF & _BOR21V
    LIST P=16F887
    INCLUDE <P16F887.INC>
    ORG 0
    
COLUM	EQU 0X20
ROW	EQU 0X21
CEROP	EQU 0X22
CONTC	EQU 0X23
CONTMOS	EQU 0X24
JUSTC	EQU 0X25
CONT	EQU 0X26
CONT2	EQU 0X27
CONT3	EQU 0X28
    
INICIO 
	    
	BSF	STATUS,RP0
	MOVLW	B'00001111'
	BCF	OPTION_REG,NOT_RBPU
	MOVWF   TRISB
	CLRF	TRISA
	CLRF	TRISD
	CLRF	TRISC
	BCF	STATUS,RP0
	
LCDSTART
	CALL	ENCENDERLCD
	CALL	TIEMPO30MS
	CALL	MODODEOPERACION
	CALL	TIEMPO39uS
	CALL	BORRARLCD
	CALL	TIEMPO1_52MS
LCDWRITE
	CALL	CURSORACASA
	CALL	TIEMPO1_52MS
	
	
TECLADOM
	CLRF	CONTMOS
	MOVLW	D'4'
	MOVWF	CONTC
	MOVLW	B'11101111'
	MOVWF	COLUM
CambioDePrueba
	
	MOVF	COLUM,0
	MOVWF	PORTB
	MOVF	PORTB,0
	ANDLW	B'00001111'
	MOVWF	ROW
	
	COMF	ROW,0
	ANDLW	B'00001111'
	MOVWF	ROW
	
	MOVF	ROW,0
	SUBWF	CEROP,0
	BTFSC	STATUS,Z
	
	GOTO	AplicacionDeCambio; SI ES IGUAL
	
	CALL	SHOWLED; DE LO CONTRARIO
	
AplicacionDeCambio
	
	RLF	COLUM
	
	
	MOVLW	D'4'
	ADDWF	CONTMOS,1
	
	DECFSZ	CONTC
	GOTO	CambioDePrueba
	GOTO	TECLADOM
	
SHOWLED
	
	MOVF	ROW,0
	CALL	NUMBERS
	ADDWF	CONTMOS,0
	MOVWF	JUSTC
	
	CALL	N2
	
	CALL	STARTWRITE
	MOVWF	PORTD
	
	
	CALL	ELIMINADOR21MS
	RETURN
	
	
NUMBERS
    ADDWF   PCL,F
    RETLW   D'0';0
    RETLW   D'1';1
    RETLW   D'2';2
    RETLW   D'0';3
    RETLW   D'3';4
    RETLW   D'0';5
    RETLW   D'0';6
    RETLW   D'0';7
    RETLW   D'4';8
    RETURN
    
N2
    ADDWF   PCL,F
    RETLW   D'0';0
    RETLW   B'00110001';1,1
    RETLW   B'00110100';2,4
    RETLW   B'00101010';3,7
    RETLW   B'00101010';4,*
    RETLW   B'00110010';5,2
    RETLW   B'00110101';6,5
    RETLW   B'00111000';7,8
    RETLW   B'00110000';8,0
    RETLW   B'00110011';9,3
    RETLW   B'00110110';10,6
    RETLW   B'00111001';11,9
    RETLW   B'00100011';12,#
    RETLW   B'01000001';13,A
    RETLW   B'01000010';14,B
    RETLW   B'01000011';15,C
    RETLW   B'01000100';16,F
    RETURN
    
ELIMINADOR21MS
	
	MOVLW	D'250' ;TENEMOS UNA RUTINA DE TIEMPO DE DE 8.31 MICRO SEGUNDO CUANDO VARTIME ES 9
	MOVWF	CONT
TA
	MOVLW	D'27'
	MOVWF	CONT2
TC
	DECFSZ	CONT2
	GOTO	TC
	DECFSZ	CONT
	GOTO	TA
	RETURN
	
TIEMPO30MS
	MOVLW	D'250' ;TENEMOS UNA RUTINA DE TIEMPO DE DE 8.31 MICRO SEGUNDO CUANDO VARTIME ES 9
	MOVWF	CONT
TA30
	MOVLW	D'39'
	MOVWF	CONT2
TC30
	DECFSZ	CONT2
	GOTO	TC30
	DECFSZ	CONT
	GOTO	TA30
	RETURN
	
TIEMPO39uS
	MOVLW	D'0' ;TENEMOS UNA RUTINA DE TIEMPO DE DE 8.31 MICRO SEGUNDO CUANDO VARTIME ES 9
	MOVWF	CONT
TA39
	MOVLW	D'13'
	MOVWF	CONT2
TC39
	DECFSZ	CONT2
	GOTO	TC39
	DECFSZ	CONT
	GOTO	TA39
	RETURN

TIEMPO1_52MS
	MOVLW	D'254' ;TENEMOS UNA RUTINA DE TIEMPO DE DE 8.31 MICRO SEGUNDO CUANDO VARTIME ES 9
	MOVWF	CONT
TA15
	MOVLW	D'1'
	MOVWF	CONT2
TC15
	DECFSZ	CONT2
	GOTO	TC15
	DECFSZ	CONT
	GOTO	TA15
	RETURN
	
T3SECS
	MOVLW	D'250' ;TENEMOS UNA RUTINA DE TIEMPO DE DE 3 SEGUNDO CUANDO VARTIME ES 9
	MOVWF	CONT
TA3S
	MOVLW	D'129'
	MOVWF	CONT2
TB3S
	MOVLW	D'30'
	MOVWF	CONT3
TC3S
	DECFSZ	CONT3
	GOTO	TC3S
	DECFSZ	CONT2
	GOTO	TB3S
	DECFSZ	CONT
	GOTO	TA3S
	RETURN
	
MODODEOPERACION
	MOVLW	B'00000000'
	MOVWF	PORTC
	MOVLW	B'00000110'
	MOVWF	PORTD
	BSF	PORTC,2; E->1
	CALL	TIEMPO30MS
	BCF	PORTC,2; E->0
	RETURN
	
ENCENDERLCD
	MOVLW	B'00000000'
	MOVWF	PORTC
	MOVLW	B'00001100'
	MOVWF	PORTD
	BSF	PORTC,2;E->1
	CALL	TIEMPO30MS
	BCF	PORTC,2;E->0
	RETURN
BORRARLCD
	MOVLW	B'00000000'
	MOVWF	PORTC
	MOVLW	D'1'
	MOVWF	PORTD
	
	
	BSF	PORTC,2;E->1
	CALL	TIEMPO30MS
	BCF	PORTC,2;E->0
	RETURN
CURSORACASA
	MOVLW	B'00000000'
	MOVWF	PORTC
	MOVLW	B'00000010'
	MOVWF	PORTD
	BSF	PORTC,2;E->1
	CALL	TIEMPO30MS
	BCF	PORTC,2;E->0
	RETURN

STARTWRITE
	MOVLW	B'00000110'
	MOVWF	PORTC
	CALL	TIEMPO30MS
	BCF	PORTC,2
	RETURN
	
	
    END